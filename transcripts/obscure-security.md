# Obscure Security on Kubernetes - Transcript

[DAWN]: Hello everyone!  Ah, it's been a while since I've been here, erm, and - I do appreciate that Rob has said that I need no introduction.  I have indeed been working more on security lately, and so today, I would like to take you through 'Obscure Security on Kubernetes'.  Do you have no idea what that means?  Cool!  Because I also had absolutely no idea what that meant, until I started delving into the wold of Kubernetes security.  So let me take you through it.

First of all, I would like to acknowledge the Wurundjeri people of the Kulin Nation, on whose land I am presenting today.  This is, and always will be, Aboriginal land.  Their sovereignty was never ceded.

Er - so I'm not going to take Rob at his word, in saying that I need no introduction.  For those of you who don't know me, my name is Dawn, and - I do a bit of everything, but at the moment, it's chiefly DevOps and cloud security that I am working on.  Just to illustrate the level of paranoia that's required to do a lot of this security work, I was not actually in the Facebook data breach that happened earlier this year, because I have never had a Facebook account.  Because as far as I'm concerned, they are a minefield of security problems.  Outside of work, I am an occasional author and kitchen alchemist.  I am also a raging sportsball fan; to that end, I have updated my speaker picture, so now, rather than being at Marvel Stadium, I'm wearing a hockey sweater instead.

So, you're setting up a Kubernetes cluster, and you want to know what you need to know about Kubernetes security.  And probably, if you are doing that, you are going to take yourselves off to the Internet and have a look at some articles about it.  What you'll find is a list of things, typically, that looks something like this.

Generally, the first cab off the rank will be external access restrictions.  Because when you set up your Kubernetes cluster out of the box, particularly if you're setting up a bare-metal cluster on your own hardware or on EC2 instances, a lot of things like the API server, and certain aspects of the- underlying structure will be open to the Internet by default.  And so, it will be suggested that the first thing you should probably do is turn that off.  Then, you have to look at, when you're actually getting to deploying workloads, how security works there.  So, when you're getting to deploying your first workloads, one of the very common recommendations that you will see is your pods all need security policies; and it's surprising how many people forget this, but - in your average enterprise, that's going to be something that everyone very much does.

Something that, ah, doesn't necessarily happen, though, is that - with Kubernetes out of the box, all of the pods on your system have some degree of interoperability, so they have some degree of being able to talk to each other.  If you want to restrict that, you'd need to set up a `NetworkPolicy`, which will shut down cross-pod communication.  Another very important thing is - in terms of the underlying structure of the Kubernetes cluster, your `etcd` drive has a lot of really important information on it, and that, by default, is not encrypted.  So, you don't really want people sniffing all of the secrets around your cluster, so you probably want to encrypt that, and you probably want some sort of monitoring in place, to make sure that nobody is making changes to it.

In terms of secrets management, er, obviously you don't want to be storing your secrets in Github or storing them directly in whatever you're using to deploy workloads, so the recommendation then will be that you set up some sort of secrets management.  Ah, you've got HashiCorp Vault, which is one that is very easy to install on a Kubernetes cluster and is open-source.  Alternatively, if you're in the AWS ecosystem, you can use the AWS Key Management Service as an alternative, and that will allow you to encrypt - any secrets that you might need, but also things like certificates that you would use for mutual TLS traffic.  In terms of authentication and authorisation, there's really only one thing to say here, which is that you need some form of role-based access control - you don't want to be giving everyone an admin token to your cluster, and you don't want everyone to have exactly the same permissions, and you don't want to be manually assigning permissions per user.  Fortunately, though, if you are using EKS, because EKS is backed by IAM roles, to some degree that role-based access control is built-in.

'But Dawn,' you say to me, 'this is a level 300 talk, so I already know a lot of these basic security things about Kubernetes.  Why are you telling me all of this?'  Well - because there are a few common gotchas, and some of these common gotchas actually lead us to talking about the topic at hand.

The obvious one, which is a bane in the life of any security person is, what happens when someone actually leaves your organisation?  Obviously, with AWS, this is not too difficult to manage if you - if you're hooked up to SSO, but, if you're doing anything bare metal in terms of role-based access control, you do actually have to have policies for what you're going to do when someone leaves the organisation to make sure that their Kubernetes access actually gets revoked, particularly if the majority of your workloads are running there.  And then you've got questions around things like - how are you doing access control for your secrets?  Because if you're using something like HashiCorp Vault, you really don't want to be giving everyone in the organization a root token, you want to make sure that you actually know who is signing into the Vault and who is changing things.  Likewise for KMS - again, it's a little bit easier because- a lot of that will be pre-configured, but you do want to make sure that you've actually shut down control over things.  Then you sort of have to worry about- not just the Kubernetes system data, and `etcd` and a lot of those other drives, but- if you have data stores that are inherent to any of your Kubernetes workloads, what are you going to do to secure those? So do you need to encrypt them, how do you make sure that they're not accessible to the whole Internet?

How are you protecting against misconfigurations, and how often do you review your security posture?  Now, these are the two really interesting ones in my view, because if you go away and look at - a lot of the things that we talked about in 'the basics', a lot of that does require some degree of manual setup.  So if every time you're creating a workload, you've got to make sure that the security policies are set up correctly, what happens if at one point someone fails to do that and something slips through code review - and then suddenly you have a workload that's exposed to the Internet?

And this is where I introduce you to the concept of 'Obscure Security', which is also known as 'the things you probably won't find in the basic user manual'.  Those of you who saw the FinOps talk that I gave in August last year would probably remember our little friend the hand-drawn bee, who is here to talk to you about buzzwords.  Because - IT as an industry is a very buzzword heavy industry, and like FinOps, security is also very buzzword-heavy.  And a lot of these obscure security concepts on Kubernetes are very very buzzword-heavy, in that, unless you've encountered them before, you're probably going to have no idea what I mean when I'm talking about things like service meshes.  But that's why you sort of have- these overviews to demystify some of those things, so - let's break some of this down and look at it in terms of the Obscure Security User Manual.

The first thing that we want to look at is general security tools that in some way integrate with our Kubernetes cluster.  And there are a couple of big ones here; the first one is application security testing, which breaks down to a whole lot of different things.  You may have heard of the concepts of SAST and DAST before if you've ever done anything with security - that's static and dynamic application security testing.  So effectively- nn, a lot of static application security testing boils down to code scanning.  Dynamic application security testing is more so black-box testing.

There's also - nn, as a bit of an extension of DAST, there's also automated tools for pen testing.  I'm not going to touch too much on those here, for the main reason that - a lot of them are not very easy to set up with Kubernetes out of the box, and there's probably better ways to do it, and that's not necessarily what an AppSec team will be dealing with anyway.  You would generally have dedicated pen testers - not AppSec, not DevSecOps, but you would generally have dedicated pen testers that would be using a lot of those.  But in terms of application security testing, that breaks down to - artifact scanning, which, for the purposes of containerised environments, is usually going to be images; code scanning, which is fairly self-explanatory; and infrastructure as code scanning, so, going away and looking at - basically your underlying workloads, the underlying, erm, infrastructure as code that you've set up for your cluster or whatever else you're running, and to see whether that is secure.

Part Two is tools that are specific to Kubernetes.  And that is really three different- or three main things.  The first one is cluster security scanning, so that's effectively tools that are going to go through and benchmark the state of your cluster against - best practices.  Then you've got things like runtime threat detection, which is trying to notify you before or at the same time as hackers are getting in.  And then there's service meshes - the aforementioned buzzword - which are really an abstraction layer on top of the Kubernetes cluster itself, that builds in a whole lot of stuff that is relevant to - security, but also site reliability-type work.  So it basically builds in a layer of observability, it builds in a layer of security, it abstracts away some of the things that you would generally have to do manually or go away and configure yourself, so it's kind of like a control plane on top of the already existing Kubernetes control plane.

So - you're interested in obscure security, and you want to actually deploy some of these things.  Well, there are a few different ways to do it: you can deploy things using `kubectl`, you can set up your own `helm` charts, but - generally what I would be looking at in terms of a lot of these tools, if you want to get things up and running quickly, is that a lot of them actually have pre-existing `helm` charts that are maintained for you, by either the people who maintain these open source projects, or by someone else who's taken it upon themselves to do that.  And the really good thing about that is you don't have to put in the effort of making sure that everything works out of the box.  Obviously, you will have to do some configuration that's specific to your own environment, which you can do using `helm` values files, but you are not going to need to set everything up - yourself, you can just often take what people have already produced and stick that on your cluster and you will be up and running.

So - I decided not to actually tempt the demo gods today, because I feel like demoing multiple tools would be just asking for something to go wrong. I am - there is a, sort of, companion workshop that goes with this, I am going to publish all of the sources for this, and I'll be giving the workshop probably in a couple of months at AWS Programming and Tools - if you want to see how a lot of this breaks down, that workshop will appear on my GitHub page at some point.  One of the important things to note, though, particularly if you're working cross provider, or if you're working on a bare metal- ah, Kubernetes setup, is - not every Kubernetes provider uses the same type of cluster management, and often those cluster management systems are very different.  So EKS has its own, Azure, Google Cloud, Alibaba Cloud all have their own, and if you're setting up a bare metal cluster, there are several different options that you can use for cluster management.  You can use `kops`, you can use Rancher, I'm sure that there are others out there.  The reason why this is important though, is because in terms of actually keeping the cluster up to date, that will be important.  But, in terms of why I decided not to tempt the demo gods, some of these tools are actually very finicky, and some of these tools, if you have things like version mismatches between your Kubernetes version and your cluster management version, you can run into some pretty big issues, particularly if you're running bare metal.  So do bear that in mind.
