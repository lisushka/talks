# Build from the Ground Up with AWS Control Tower

Good evening, as always, it is a pleasure to be here tonight at the AWS user group to give this talk on one of AWS s, new services control tower, which will allow you to build your AWS organizations and security framework from the ground up. I would like to begin tonight by acknowledging the Wurundjeri people of the Kulin nation on whose land I'm recording this is and always will be Aboriginal land. Their sovereignty was never seated and I would like to pay my respects to their elders, past present and emerging. Some of you probably have met me. Some of you may not have done. If you haven't met me, you would want to know Who am I? My name is dawn echolert. I am an associate DevOps /soe at my OB. I have worn both hats and my aim when I start work on Monday, is to improve the systems that I work on. My close of business Friday doesn't always happen, but I try outside work. I am an occasional author and kitchen alchemist. Sometimes that goes well. Sometimes it doesn't. I am also a raging sports ball fan, which is why that picture of me is me at Marvel Stadium. So, in order to actually dissect how AWS control tower works, we're going to look at a hypothetical use case. I would like you to meet product core product core is a hypothetical product company startup with a head office in Sydney they were founded about five years ago and they offer two products. The first one is a managed inventory platform software as a service called bias. The second one is a managed online shopping platform called sallet and, most importantly, for their talk. All of the infrastructure runs on AWS. This is Ben wing. Their product calls lead cloud engineer. They'Ve got ten years of experience, mostly working for start and part of the reason that they took this job at product. Core is because a lot of the infrastructure at product core is immature and somewhat outdated and they're very passionate about being able to get in and improve infrastructure. So when been arrived at product core, what they found was a bit of a mess product core had just two AWS accounts in one organization. They had one account for all their dev services and one account for all their prod and I'm guessing. Most of you probably know why that's a bad idea, if you don't roughly look up the principle of least privilege. Basically, the idea is you: don't want multiple services running in the same account, if you can avoid it, because you want people to have access to the minimum possible number of things. That means, if you get hacked, then attackers potentially only get access to one product starter. As compared to product startup - and they do currently have some basic detective guardrails set up using service control policies, but their guardrails are not very mature as far as actual account access they manage all of their access using. I am users which is not great for an organization of that size, but we'll come back to that. What'S worse is that they don't require 2fa. So that means that, as long as you get the username and password on those iam users, you can go in and do whatever you want. The security guard rails that they do have are fairly immature and a mostly restriction based and, very importantly, for this they don't use proactive security services like guard duty now. Guard duty is not directly related to the sort of content of this talk, but it comes back to a theme that we'll talk about a bit later, so Ben sits down and they produce a plan for what they think that product cause. Aws services could look like they obviously have a great concern about security and they think that the actual organization's can be structured better. So they built this plan and they take it to any jobs whose products cause CFO. She originally worked for an auditing firm and as this, therefore, her primary focus is value for luck. The CTO has signed off on this plan, but she doesn't really know a lot about security, so she doesn't understand the value in it. Basically, the way that Ben sells it to her is by explaining that it's going to be a lot cheaper for them to sort out security now than it is if they potentially get hacked down the line where they could open themselves up to fines and reputational damage. So only upon hearing that hires, marina voltner to be product cause new security function. She came from a consulting organization that tended to work a lot with bleeding edge, AWS services and was very much at the forefront of using new AWS services to improve security and governance practices. She also holds multiple AWS security, certifications, so Ben and Mary sit down together and they form a plan for first phase of how they think they can improve product course systems, rather than just having one ru they're going to have four they're going to have a production. Oh, you are pre proto, you a dev, oh you and a lab. Oh you and restrictions on those will all be set up differently. There'S going to be an individual prod, prod account for each of product, core services, which will eventually be migrated as the development teams complete migration from the monolith, application to one AWS account per micro service and all the AWS accounts will talk to each other. There will be individual dev accounts for each micro service that the teams are currently working on and one lab account per team to allow them to spike out things that they might want to try. Now, while Murray was working as a consultant, she worked a bit with AWS control tower, which is a service that was recently released to general availability and very recently, like earlier this year, enabled in Sydney what Ben and Murray plan to do is to manage their entire Aws organization, using control tower, which will allow them to provision new accounts using account factory to ensure that guardrails are applied. It will allow them to all control tower, will enforce those guardrails on Oh use for them so that they don't have to do it themselves. By setting up SCPs and they're also going to take advantage of control towers, strong recommendation to set up sync sign-on and move away from, I am users to use AWS SSO once they've got all the basics out of the way they're going to leverage that basic security Posture to also lean more on proactive security services such as cloud trail and guard duty, which will make them aware when there's potentially an unauthorized intrusion into their accounts. Now this is not related to control tower specifically, but it's something that I think control tower allows you to do is to not worry about the basics of security and use those basic guardrails that you have to then focus on leveraging those to basically create more of A proactive security posture and now that they've developed this plan, they are going to go away and actually perform the migration at the start of the migration. This is what their AWS organizations look like it's fairly basic. Obviously, those are not really mail addresses I've. Their test email addresses that I've used for this, and I've blocked them out for that reason, but they have their one master payer account, and then they have an account that has all of their production services and all of their development services. The first step for them is to go in and deploy AWS single sign-on, because as soon as you do that you remove an awful lot of security holes now, control tower will prompt you to do that as part of the setup process and, if you're not using Some kind of SSO already like if you're using, I am users actively to access your accounts, that's something you really should be doing once they've done that they're going to go into their new newly provisioned AWS SSO, using their accounts and enroll, the master power account in Control tower what that means is that any new OU's that they create through control tower will start with all of the mandatory guardrails enabled and that they can now create new accounts using account factory to enroll them directly in those OU's. So this is what the setup screen for control tower looks like it's fairly, simple, there's a bit of a blood at the top, which explains some of the basics. Now for anyone who's not seen a talk by me before I do use a zoomed in screen setting. So I apologize for the fact that there's going to be information missing and a lot of information that split across multiple different slides, I don't really have way to avoid that. But you have a brief explanation of the pricing in the home region. We'Ll come back to the pricing, but control tower itself doesn't actually cost you any money. It'S the services, the control tower provisions of what you need to be concerned about in terms of the pricing. The reason that we're using USA's does the home region for this demo is that I have other things deployed in these AWS accounts. So that's the region that my SSO is set up in then you will be asked to provision a couple of shared accounts. Now, obviously, the master account is the master player account. You will not be able to change that, but you'll also be asked to provision a log archive account in an audit account logon. I'Ve account is where all of the information that controlled how're - you know all of the logs of control towers, api's all of the logs of resource configurations, will go straight to that log account in an s3 bucket. The audit account is quite important because it's basically an account that allows your security and governance teams to assume a read or write access in of AWS accounts with an audit trail. So you don't need to give your security and compliance teams access to all of your AWS accounts if you're using control tower. They can assume that at that access through the audit account when it's necessary. So if there's an issue with compliance, myrick can go in and have a look at. One of the AWS accounts and ben will still be able to follow what mary has done. Using that audit trail, then they'll you'll be given a brief description of the permissions that control tower needs to set everything up. A lot of those are very basic, around meeting to actually be able to set up resources using AWS, config and using the service control policies. But if you do want to use control tower, make sure that you do take a look through those it's out of the scope of this talk to really go into. But it's an important thing to know what AWS is actually deploying. Then control tower will create two OU's for you automatically. The first one is the core öyou, which contains the log, are kind of an audit accounts that you have to create by default. That is managed by control tower. You can't and shouldn't touch it. The other one is a custom out you which contains user created AWS accounts. Obviously you can have more than that they're just giving you something to start with, and then, if you do want to create new OU's enroll directly in control tower, you need to do it via the landing zone. Page any OU's that you create using the AWS organization's page that you might be used to will not be enrolled in control tower and at the moment you won't be able to enroll them. So if you want to enroll in uou, you need to do it through the control tower landing zone page. This is what that looks like here. As you can see, Ben and Mari have already created some of the OU's that they'll want to use and in order to create another one, they just click on the orange button with, I don't know you text on it, which will bring them effectively to a dialog Box that just asks them to put in their name as far as actually provisioning, guardrails that man or provisioning, elective guardrails and strongly recommended guardrails is not something that you do here. You just set up. Do you with the no and once Ben and Maria done provisioning? All of their OU's - this is what it looks like the legacy of you is going to be where they're going to enroll their existing AWS accounts. So when they actually provision new accounts, adding the accounts directly to control tower is handled by the account factory right now that holds for both new and existing accounts. So it's exactly the same process. So let's look at one of the new accounts that they create. This does the production account for the Bayete service. You pretty much just have to give an email. You have to provide a display name for the account which in this case is buy it. You do need to designate at least one SS or user that has access to that it to the account. I haven't done that because that will vary depending on how your SSO uses a setup, but you will need to provide that information and then obviously, you select the organizational unit that the accountant is enrolled into and that account will provision automatically with all of the guardrails. On that, oh you enabled now provisioning of control tower itself takes about 60 to 90 minutes. Provisioning of the individual accounts took, I think, between 3 and 10 minutes for me, but you're able to monitor the process of account provisioning through the actual. I believe this is the service control policy dialogue. It'S not one that I'm super familiar with, but you can go in here. It will explain to you what it is actually going on as you provision product, and you will be able to see a description of what's going on the in progress text once you're done. Will change to completed now. Control tower also has a life cycle event which record the actions that control tower carries out. They basically just show the success or failure state, and you can use them for automation, so they are picked up. There are accessible via API. If you want to then once an account is finished, provisioning say upload some things to an s3 bucket. You can do that programmatically and those life cycle. Events are sent to cloud trail by default. Now I mentioned that I use a zoomed in screen, I'm not actually going to show you what the cloud trail for this looks like, because AWS is UI for that is so poorly designed that I actually can't see any of the information on it. So if you do want to find out more about that, go and check it out yourself, then Ben and Barry sort of performed the rest of the security order. They clean up the old iam users, ensure that they've got guard duty, enabled go and check to make sure the cloud trail is actually receiving control, towers, life cycle events and also enforce some extra detective guardrails on the legacy account ru during the migration process. So what they're basically doing here is they're leveraging the basic security posture that control tower gives them to be able to delve a bit more into proactive security. So when you want to enable guardrails you have to actually rather than enabling them by. Oh you, you have to actually go into the guardrails tab in control tower and then select the guardrail that you want to enable, in this case we're going to enable the guardrail to disallow public access to IDs database instances which you can do then, just by basically Selecting the overview that you want to enable it on and hitting the ok button at the bottom of the page, which you can't see because of the zoom screen now a few days after Bennett and Mari have finished setting all of this up. We meet Fred Watson, Fred Watson is a us-based black hat hacker and he wants to get into the product called databases to steal customers identities, because he's heard that their security is very poor, he's also quite lazy. So one of the tactics that he is going to used in his attempt to get access are fairly standard tactics that you would see from fairly local of blockers. Last time I ever talked like this. Someone told me that they were disappointed that I didn't get an actual hacker into it. So this time I'd figured that we'd get natural hacker into it and we'd see how well control tower manages to foil him. So round 1 Fred bought some leaked credentials from one of product caused old. I am users which were leaked by disgruntled employee from the dark web and he attempted to use those credentials to access product cause. Aws accounts, however, because Murray cleaned up the old AM uses as part of the security ordered Fred's attempt to get into the account fails round. Two Fred also ran a small spearfishing campaign to get access to some credentials for some of the products called RDS databases. Now he attempted to use those to get into one of the production databases. But what he finds is that, because Ben and Mari enabled strongly recommended guardrails that enforce encryption on RDS instances and made sure that all of their IDs instances in the legacy of you were in compliance. His attempt fails for round three Fred goes back to our old friend s3, which is probably one of the most insecure services of AWS runs in the legacy production account he locates public s3 bucket and attempts to download files from it. Now the detective guardrails do tell product call that this deserves security issue, but because they haven't finished following up on the recommended actions. Yet threads attempt to get in and download information insuk state he downloads. Basically, a list of some information about staff working on migrating start from monoliths to micro services. However, because god he is set up to report security fence God, you called Fred's IP address. So when Bennett and Murray get back to the office on Monday morning - and they notice that there is a large warming say that someone from the US outside hours, so you go in and have a look what's actually going on in the bucket now we can see That there's the text file stuff I started called and when Mary open up come across this old chestnut, which can anyone who swore my abstinence remember. So they publish what happened, how they identify it and how they're going to remediate those issues. But what was noticing here is the information that obtained from the public s3 bucket was actually very limited. I'D been able to get in through the eye and use up, which was disabled. Well, the idea essence, which was encrypted the damage, would likely have been a little more extensive and not total straight Howard does in because your basic security posture, you can then focus on closing some of those more hello. We'Re back is waiting for you too, to come back sorry about that everyone we had a map in your encoder crashed, though that's not a good thing as we've, but yeah we're back up. Alright I'll bring the presentation back up. Sorry about that again, he's also quite lazy. So a lot of the tactics that he's going to use in his attempt to get access a fairly standard tactics that you would see from fairly low level hackers. Last time we ever talk like this, someone told me that they were disappointed that I didn't get an actual hacker into it. So this time I figured that we'd get an actual hacker into it, and we'd see how well control tower manages to foil him superb round. One Fred bought some leaked credentials from one of product calls old by AM users which were leaked by disgruntled employee from the dark web, and he attempted to use those credentials to access product cause. Aws accounts, however, because Murray cleaned up the old day and users as part of the security order, Fred's attempt to get into the account fails around Fred, also ran a small spearfishing campaign to get access to some credentials for some of products called RDX databases. Now he attempted to use those to get into one of the production databases, but what he finds is that, because Ben and Murray enabled strongly recommended guardrails that enforced encryption on IDs instances and made sure that all of their IDs instances in the legacy are you were In compliance is attempt, fails for around three fred goes back to our old friend, a story which is probably one of the most insecure services that AWS runs in the legacy production account he locates public s3 bucket and attempts to download files from it. Now the detective guardrails do tell product call that this is a security issue, but because they haven't finished following up on the recommended actions. Yet Fred's attempt to get in and download information succeeds. He downloads basically a list of some information about staff that are working on migrating salad from monoliths to micro services. However, because guard duty is set up to record security events - God usually records Fred's IP address. So when Ben and Marie get back to the office on Monday morning - and they notice that there is a large warning saying that someone from the US has accessed this bucket outside hours, they go in and have a look at. What'S actually going on in the bucket. Now we can see that there's the text file of stuff access data, it's also an image called hacked and when Ben and Mary open up they come across this old chestnut, which anyone who saw my talk on Amazon inspector will probably remember so they have their PIR And they publisher knows is explaining basically what happened, how they identify it and how they're going to remediate those security issues, but, what's worth noting here, is that the information that Fred obtained from that public s3 bucket was actually very limited. Had he been able to get in through the IAM user, which was disabled or the RDS instance, which was encrypted, the damage would likely have been a lot more extensive and that sort of illustrates what control tower does in that, because it gives you a basic security Posture, you can then focus on closing some of those more obvious security holes. As far as pricing goes, as I mentioned earlier, control tower itself is actually completely free. What you pay for are the services that control tower users to perform its task, so Service Catalog, which is used for the detective guardrails costs you five US dollars per month per account factory portfolio and each account then gets 1,000 free API calls per month. After that, it costs a very, very small amount of money which I'm not going to attempt to read per API call now they'll add up so do make sure that you understand how the pricing works, but it's not particularly expensive running-config. It costs you 0.3 cents per configuration recorded in config and then for every resource that you provision. It'S evaluated against rules and pricing for the rule. Evaluation starts at 0.1 cents per evaluation pro region and it has tiered discounts based on volume. There are some additional charges in terms of the charges for cloud trail, login gesture, incites charges for cloud watch, metrics and charges for the log archive buckets the s3 buckets in the log archive account. But if you want to understand those charges more extensively, I would recommend that you check the pricing examples page because it's very hard for me to breakdown in the talk now, as you may have sort of gathered from what we've been discussing here, controls how it is Bleeding edge software, and while that comes with some advantages, it comes with some disadvantages as well. In terms of current constraints, one of the things that I think will be on the roadmap for control tower is to be able to customize guardrails, which is something that you can't do at the moment. If you can add in custom SCPs to develop your own guardrails, that is going to make the utility of control tower much greater, because it will mean that you no longer have to provision that manually yield using SCPs. You can't have multi-level OU's at the moment now. This would potentially be an issue if you wanted to have say your proto: u and then, once everything is migrated over to microservices, they wanted to have an o' you for biotin and o you for sell it. Currently, you can't do that. That'S another thing that my expectation is that's going to be on the roadmap in the next 6 to 12 months. So it may not be a concern for you if you're looking at using it in the future, but it is at the moment one of the things as well with control tower. Is it kind of locks you into click ops because it doesn't actually have an API? So, there's not a lot that you can do with it programmatically. So, if you're working in a very mature institution which does a lot of programmatic and API work around AWS, this is probably not going to be a great solution. The one which kind of interested me is that migrating existing accounts into control tower isn't totally seamless. There were a couple of accounts when I was testing this that no matter how hard I tried I could never get in, because I was getting unknown errors. I'D. Imagine that will be fixed fairly quickly, but if you're planning on doing this now it's something to be aware of. So when should you use control tower, even though it's a fairly new service? I think there are already a few really compelling use cases for this. One of them is sort of the use case of product call that we've looked at, which is an immature organization. That'S in the process of scaling everything up, because you you can delegate a lot of that basic security to control tower. You can then get in and do a lot of the proactive security work around enabling guard duty, possibly more advanced scps, without having to worry too much about the basic things. Another use case that I think is quite compelling, even if you do have a larger portfolio, is during a significant restructure, because, if you're rearranging a lot of the accounts anyway, it may not be a huge issue to move everything over to control tower, where you're creating New accounts, if you only have a few existing accounts to migrate. The third use case is, if you are part of a company, that's undertaking a cloud migration and you've brought consultants in to do it with few or no permanent support staff. If you're part of a consulting company, this is absolutely something I think you should have in your toolbox, because there are a lot of cases where you would come in and do work for a small company where this is exactly the right thing to use. It will allow you to set things up in a way, that's very hard for people to break and a lot of the then sort of level tasks like provisioning, new accounts that can all be done by someone just using someone just using the console. So this we've reached the end of the talk. If you do have any questions about using control tower, I am happy to answer them. I was also contacted by some of the folks at AWS who are interested in whether they might be able to help get people who want to use control tower in touch with their solutions. Architects. So, if that's something that you're interested in, if this has piqued your interest - and you want some information on how you might use it - then use the QR code on this slide. To get yourself in touch with AWS and they'll. Put you in contact with the solutions architecture, you should be able to help also that QR code does have some speaker feedback for me. I don't mind whether you fill that in or more if you feel so inclined to go ahead. If you don't, then don't I'm always interested to hear feedback from people, whether it be through that or personally, but whatever you prefer to do, is totally fine by me. So that concludes the talk, and I do hope that the information in this talk will at some point, allow you to improve your systems by close of the this Friday, thanks Don. That was an excellent presentation again. This is the time where everybody who hasn't asked a question yet can quickly. So meantime, we had a gem to thank for a couple of them so start with those gems. First question is: does control tower support guard duty or does that need to be installed with confirmation? Admittedly, when I did all of this, I did it the click ops version, because control tower itself does not have programmatic support, but if you want to enable guard duty, you need to do that within guard duty. There'S no button in control tower that you can click that will allow you to just enable guard duty along with it related question. Have you been using the customizations for the universe control tower to deploy things like pcs or transit gateway? That was a fun one. I dabbled in it a very tiny bit trying to work out what what the parameters of it were. The issue that I ran up against and that something that I highlight in the talk is control tower is really really bleeding edge, and I have a feeling that in six to twelve months, it is going to look very different and it is not something that I Was inclined to look at too much when the solution itself is not particularly mature, because I would generally want to be able to keep doing things that I currently do. Programmatically I'd want to be able to keep doing that and it from the little bit that I looked at it. It didn't seem to me that there was as much flexibility in the customizations as I would want yeah. So you may sit a bit in the presentation as well, but the inability to do things in a programmatic way. You yeah things like that. It'S a deal breaker for you isn't it. I think it's one of those things where, as I said, it really depends on your use case, because I think that there are use cases where this does work, but very mature organizations that tend to lean on being able to do things programmatically a lot. I do not think this is currently a good solution there are. I anticipate that a lot of the things that I highlighted around being locked into clique, ops and the fact that you can't customize guardrails yourself will be resolved in the next six to 12 months. But at the moment I think that it's unless you're an immature organization yourself. I think it's just too immature of a solution for me to be able to recommend it to very mature organizations that do a lot of things programmatically, because your workflow you're not going to be able to use control tower and keep doing what you've been doing. With your workflow or, if you've, still doing a lot of the things that you're doing with your work, a lot of the effort that you put into setting up control tower could probably be a better spent elsewhere, and that was my feeling. With with the customizations. Is I looked at it and when I played around with it a little bit, I basically thought look your efforts, probably better spent elsewhere. That'S fair enough! Yeah Center! Ok, I'm not seeing any other questions prop up. So I guess you did an awesome job. That'S always good to be here yeah. Thank you very much, Don, no problem, I'm sure I'll be back in a couple of months with the next Walden wonderful thing that I run across 

[Back to main talks repo](https://github.com/lisushka/talks)
