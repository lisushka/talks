# Build from the Ground Up with AWS Control Tower

ROB: Thanks, guys.  So, up first tonight, we have Dawn.  Erm, Dawn has recorded us another presentation again - erm, she's [sic] a regular contributor now to the Melbourne AWS User Group, we're really thankful for the effort that she puts into these presentations.  Ah, so without further ado, we'll throw over to the great introduction, I hope, to Control Tower.  I'm looking forward to this one.

DAWN: Good evening!  As always, it is a pleasure to be here tonight at the AWS User Group to give this talk on one of AWS' new services; Control Tower, which will allow you to build your AWS organisations and security framework from the ground up.

I would like to begin tonight by acknowledging the Wurundjeri people of the Kulin nation on whose land I'm recording.  This is and always will be Aboriginal land, their sovereignty was never ceded, and I would like to pay my respects to their elders, past present and emerging.

Some of you probably have met me, some of you may not have done; if you haven't met me, you would want to know: who am I?  My name is Dawn E. Collett, I am an associate DevOps/SRE at MYOB - I have worn both hats.  And my aim, when I start work on Monday, is to improve the systems that I work on by close of business Friday.  It doesn't always happen, but I try.  Outside work, I am an occasional author and kitchen alchemist - sometimes that goes well, sometimes it doesn't.  I am also a raging sportsball fan, which is why that picture of me is me at Marvel Stadium.

So, in order to- actually dissect how AWS Control Tower works, we're going to look at a hypothetical use case.  I would like you to meet ProductCorp.  ProductCorp is a hypothetical product company startup, with a head office in Sydney; they were founded about five years ago, and they offer two products. The first one is a managed inventory platform software as a service called BuyIt; the second one is a managed online shopping platform called SellIt.  And most importantly for their talk, all of their infrastructure runs on AWS.

This is Ben Nguyen.  They're ProductCorp's lead cloud engineer.  They've got ten years of experience, mostly working for startups, and- part of the reason that they took this job at ProductCorp is because - a lot of the infrastructure at ProductCorp is immature and somewhat outdated, and they're very passionate about being able to get in and improve infrastructure.

So, when Ben arrived at ProductCorp, what they found was a bit of a mess.  ProductCorp had just two AWS accounts in one organisation; they had one account for all their dev services and one account for all their prod services, and- I'm guessing most of you probably know why that's a bad idea.  If you don't - roughly, look up the principle of least privilege; basically, the idea is you don't want multiple services running in the same account if you can avoid it, because you want people to have access to- the minimum possible number of things.  That means if you get hacked, then - attackers potentially only get access to one product's data as compared to two product's data.  And they do currently have some basic detective guardrails set up using service control policies, but their guardrails are not very mature.

As far as actual account access, they manage all of their access using IAM users, which is- not great for an organisation of that size, but we'll come back to that.  What's worse is that they don't require 2FA, so that means that as long as you get the username and password on those IAM users, you can go in and do whatever you want.  The security guardrails that they do have are - fairly immature and are mostly restriction based, and, very importantly for this, they don't use proactive security services like GuardDuty.  Now, GuardDuty is not directly related to - the, sort of content of this talk, but it comes back to a theme that we'll talk about a bit later.

So, Ben sits down, and they produce a plan for what they think that ProductCorp's AWS services could look like.  They - obviously have a great concern about security, and they think that the actual organisations can be structured better.  So they build this plan and they take it to Annie Jones, who's ProductCorp's CFO. She- originally worked for an auditing firm, and as the CFO, her primary focus is value for money.  The CTO has signed off on this plan, but she doesn't really know a lot about security, so- she doesn't understand the value in it.  Basically, the way that Ben sells it to her is by explaining that it's going to be a lot cheaper for them to sort out security now than it is if they potentially get hacked down the line, where they could open themselves up to - fines and reputational damage.

So Annie, upon hearing that, hires Marie Novotna to be ProductCorp's new security function.  She came from a consulting organisation that tended to work a lot with bleeding-edge AWS services, and was very much at the forefront of using new AWS services to improve security and governance practices.  She also holds multiple AWS security certifications.  So, Ben and Marie sit down together, and they form a plan for - the first phase of how they think they can improve ProductCorp's systems.

Rather than just having one OU, they're going to have four.  They're going to have a production OU, a pre-prod OU, a dev OU, and a lab OU, and restrictions on those will all be set up differently.  There's going to be an individual prod or pre-prod account for each of ProductCorp's services, which will eventually be migrated, as the development teams complete migration from the monolith application, to one AWS account per microservice.  And all the AWS accounts will talk to each other.  There will be individual dev accounts for each microservice that the teams are currently working on, and one lab account per team to allow them to spike out things that they might want to try.

Now, while Marie was working as a consultant, she worked a bit with AWS Control Tower, which is a service that was recently released to general availability, and very recently - like earlier this year - enabled in Sydney.  What Ben and Marie plan to do is to manage their entire AWS organisation using Control Tower, which will allow them to provision new accounts using Account Factory to ensure that guardrails are applied; it will allow them to- or, Control Tower will enforce those guardrails on OUs for them so that they don't have to do it themselves by setting up SCPs; and they're also going to take advantage of Control Tower's strong recommendation to set up single sign-on, and move away from IAM users to use AWS SSO.

Once they've got all the basics out of the way, they're going to leverage that basic security posture to also, lean more on proactive security services such as CloudTrail and GuardDuty, which will make them aware when there's potentially an unauthorised intrusion into their accounts. Now this is not related to Control Tower specifically, but it's something that I think Control Tower allows you to do, is to not worry about the basics of security, and use those basic guardrails that you have to then focus on- leveraging those to- basically create more of a proactive security posture.

And now that they've developed this plan, they are going to go away and actually perform the migration.  At the start of the migration, this is what their AWS organisations look like.  It's fairly basic.  Obviously, those are not - real email addresses, I've - they're test email addresses that I've used for this, and I've blocked them out for that reason.  But they have their one master payer account, and then they have an account that has all of their production services, and all of their development services.

The first step for them is to go in and deploy AWS Single Sign-On, because- as soon as you do that you remove an awful lot of security holes.  Now, Control Tower will prompt you to do that as part of the setup process, and if you're not using some kind of SSO already, like if you're using IAM users actively to access your accounts, that's something you really should be doing.  Once they've done that, they're going to go into their new- newly provisioned AWS SSO using their accounts, and enrol the master payer account in Control Tower.  What that means is that any new OUs that they create through Control Tower will start with all of the mandatory guardrails enabled, and that they can now create new accounts using Account Factory to enrol them directly in those OUs.

So, this is what the setup screen for Control Tower looks like.  It's fairly simple, there's a bit of a blurb at the top, which explains some of the basics.  Now, for anyone who's not seen a talk by me before, I do use a zoomed in screen setting, so I apologise for the fact that there's going to be information missing, and a lot of information that's split across multiple different slides - I don't really have a way to avoid that. But - you have a brief explanation of the pricing in the home region.  We'll come back to the pricing, but Control Tower itself doesn't actually cost you any money, it's the services that Control Tower provisions are what you need to be concerned about in terms of the pricing.  The reason that we're using `us-east` as the home region for this demo is that I have other things deployed in these AWS accounts, so that's the region that my SSO is set up in.

Then, you will be asked to provision a couple of shared accounts.  Now, obviously - the master account is- the master payer account - you will not be able to change that, but you'll also be asked to provision a log archive account and an audit account.  The log archive account is where- all of the information that Control Tower - you know, all of the logs of Control Tower's APIs, all of the logs of resource configurations, will go straight to that log account in an S3 bucket.  The audit account is quite important because - it's basically an account that allows your security and governance teams to assume, ah, read or write access in other AWS accounts with an audit trail.  So you don't need to give your security and compliance teams access to all of your AWS accounts if you're using Control Tower, they can assume the- ah that access through the audit account when it's necessary. So, if there's an issue with compliance, Marie can go in and have a look at one of the AWS accounts, and Ben will still be able to follow what Marie has done using that audit trail.

Then, they'll- you'll be given a brief description of the permissions that Control Tower needs to set everything up.  A lot of those are very basic, around meeting to actually be able to set up resources using AWS Config and using the service control policies, but if you do want to use Control Tower, make sure that you do take a look through those.  It's- out of the scope of this talk to really go into, but it's an important thing to know what AWS is actually deploying.

Then, Control Tower will create two OUs for you automatically.  The first one is the core OU, which contains the log archive and audit accounts that you have to create by default.  That is managed by Control Tower - you can't and shouldn't touch it.  The other one is a custom OU, which contains user-created AWS accounts.  Obviously you can have more than that, they're just giving you something to start with.  And then, if you do want to create new OUs that are enrolled directly in Control Tower, you need to do it via the landing zone page.  Any OUs that you create using the AWS organisations page that you might be used to will not be enrolled in Control Tower, and at the moment, you won't be able to enrol them.  So if you want to enroll a new OU, you need to do it through the Control Tower landing zone page.

This is what that looks like here.  As you can see, Ben and Marie have already created some of the OUs that they'll want to use, and in order to create another one, they just click on the orange button with the `Add an OU` text on it, which will bring them, effectively, to a dialog box that just asks them to put in a name.  As far as actually provisioning guardrails- that man- or, provisioning elective guardrails and strongly recommended guardrails is not something that you do here, you just set up the OU with the name.  And once Ben and Marie are done provisioning all of their OUs, this is what it looks like.  The legacy OU is going to be where they're going to enrol their existing AWS accounts.

So when they actually provision new accounts, adding the accounts directly to Control Tower is handled by the account factory.  Now that holds for both new and existing accounts, so it's exactly the same process.  So let's look at one of the new accounts that they create.  This is the production account for the BuyIt service.  You pretty much just have to give an email, you have to provide a display name for the account, which in this case is BuyIt.  You do need to designate at least one SSO user that has access to that- ah, to the account.  I haven't done that, because that will vary depending on how your SSO users are set up, but you will need to provide that information.  And then, obviously, you select the organisational unit that the account is enrolled into and that account will provision automatically with all of the guardrails on that OU enabled.

Now, provisioning of Control Tower itself takes about 60 to 90 minutes.  Provisioning of the individual accounts took, I think, between 3 and 10 minutes for me, but you're able to- monitor the process of account provisioning - through the actual- I believe this is the service control policy, erm, dialogue.  It's not one that I'm super familiar with.  But, you can go in here, it will explain to you what it is actually going on as you provision the product, and you will be able to see a description of what's going on.  Erm, the `In progress` text, once you're done, will change to `Completed`.

