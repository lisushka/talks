# Control Tower 12 Months On - Transcript

DAWN: All right!  Ah, welcome back everyone!  Once again we are looking at AWS Control Tower; and it's not really 12 months on, is it?  Because I think it was actually about- August or September last year that I did the original presentation.  But, this is a look at AWS Control Tower 12 and a bit months on.

Ah, first off I would like to acknowledge the Wurundjeri people of the Kulin Nation on whose land I am presenting tonight.  This is and always will be Aboriginal land.  Their sovereignty was never ceded.

Yeah, I- I probably don't need an introduction by now, but on the off chance that there are people here who- haven't seen the introduction before, my name is Dawn.  I'm now doing cloud security and DevOps at Innablr - goodness me, I do move around a lot! - and Innablr is hiring. Er, and my approach to handling AWS environments is effectively - the more AWS accounts the better!  Spin them down, bring them back up again, configure them, leave them as sandboxes for people to work in.  Outside of work, I am an occasional author and kitchen alchemist - sometimes that ends really well, sometimes it doesn't.  I'm also a raging sportsball fan, which is why I rotate through pictures of me doing or wearing sportsbally things.

So - a little bit over 12 months ago, we met ProductCorp.  And yes, it is pronounced 'ProductCorps' even though it's spelt ProductCorp, because startups are naff and want to use anything they possibly can to differentiate themselves.  So let's meet ProductCorp yet again; let's have a little refresher on what they're actually doing.  So this is, ah, a startup; their head office is in Sydney, and ProductCorp's primary market is in e-commerce software.  So they have two flagship products: they've got BuyIt, which is a- inventory management software as a service platform; which connects with SellIt, their other flagship product, which is effectively a managed online shopping platform similar to Shopify.  Everything that ProductCorp does is targeted towards the Australian market, being that they're a startup with their head office in Sydney, and their infrastructure runs on AWS, which is very important for what we're looking at here.  They've been in business for about seven years, and they're starting to hit the scale where- they've got a bit of money to play around with as a result of investments now, and they've been using other payment processors and have decided that they want to cut out, ah, the middleman.  And so they have gone out and bought a payments processing company called Fly Money.

And the process of merging all of Fly Money's workloads into ProductCorp's existing setup will be headed up by Ben Nguyen, who we have met before but they've been promoted since the last time we talked they're now ProductCorp's head of engineering and they're very passionate about improving infrastructure in general they've got over 10 years of experience so they are quite looking forward to seeing what they can learn from Fly Money's systems.  Spoiler: probably not going to be what you think it is.  You know, they've mainly worked with startups before, so they're very familiar with this sort of- running AWS at a small scale and scaling it up.

And in terms of the way that ProductCorp's AWS accounts are set up, unlike when we checked in with them- a bit over 12 months ago, it's actually quite sensible.  So they've got everything split out into separate organisational units and because they don't have too many products it's split out basically according to the production life cycle so they've got prod pre-prod devon lab and for each of their services that they're running they have individual pre-prod and dev accounts for those and for microservices some of them are split out into separate accounts as well they've also got one lab account per team basically a sandbox where people can go in and play around with things and their account management and guard rails that's all done with Control Tower a couple of interesting things to note though all of product calls workloads run in ap southeast too and that's going to be important later the other thing that's important to note is that their access to AWS is controlled via sso which is backed by an identity provider so things like azure ad octa I know there are a few others um google workspace unfortunately doesn't quite work for this because it's only got about a quarter of the features of a full-fledged IDP but it's very easy to basically plug your IDP into AWS and have that manage sso for you and that's what ProductCorp are currently doing now Fly Money's AWS accounts unfortunately for poor Ben are a bit of a different beast they their head office is actually in melbourne so they are an australia-based company but their primary market is sort of emerging markets so they're looking they operate primarily in europe uh but also in africa and south america and that means that their workloads are running across a total of seven different AWS regions when it comes to the accounts though it's a bit of a wild west uh not only do they have not really any particular controls over what can be deployed into their accounts they've only got three of them and they don't really have clear boundaries about what goes where I'm sure everyone at this point is starting to quietly grown to themselves what's even worse though is that their access is all managed by IAM users and I'm sure I don't need to go over again why that's a problem particularly for a payment processing company so Ben's a bit worried at the end of this meeting where everything is handed over to them and they get on the phone to Marie Novotna and she's been promoted as well since we last checked in with her she's now ProductCorp's security lead and by the time that this phone call is finished she's starting to get the feeling that she was sold a bit of a lemon because she was told that Fly Money had excellent AWS governance and so she with her multiple AWS security service is currently a little bit cross so they meet with annie jones who we've also met before uh which is interesting because she used to work for an auditing firm and so of all of the people that work at ProductCorp's she is the one that is most familiar with auditing processes which is one of Ben and Marie's first concerns and she has absolutely no idea how Fly Money ever passed a pci audit because it's quite easy once you've got you know if you've got pci workloads that are properly isolated it's quite easy to be able to deploy other stuff to AWS accounts and use some interesting attack vectors that you can't use from outside the eco or from outside that individual account so there's an emergency meeting called with basically all of the c-suite in it and Ben and Marie are given full blessing to go in and do whatever they need to do to fix up the situation with the Fly Money AWS accounts and they're going to fall back to the tried and true maxim of using existing patterns and things that you already know you can get working which in this case is AWS Control Tower so Ben and Marie's new plan is actually fairly similar to Ben and Marie's old plan when we first checked in with them a little bit over 12 months ago so the first thing that they're going to do uh with a little bit of fiddling around with enrolling and unenrolling from organisations is get all of Fly Money's accounts into the product called AWS organisation in isolated into one o u and then they're going to take that existing ou and they are going to enroll it into Control Tower once they've done that which at least gives them some basic governance then they've got to do the leg work that Control Tower enables you to do around splitting workloads out into multiple AWS accounts and actually making sure that they've got the structure in there that would allow them to pass a pci audit without telling too many small fibs the other thing that they really want to do here is get rid of all of the IAM users and their plan to do that is all of the Fly Money employees have been issued with product called email addresses so they're just going to migrate all of those logins into the product called IDP and have everything accessible via AWS sso and the new Fly Money accounts are going to follow very much that same sort of split separate accounts for each of the seven regions one production and pre-prod account per region one dev account per service per region and those will have region restrictions as well on deployments because then it means if someone goes and breaches Fly Money's operations in south america they don't necessarily get into everything else and the old one lab account per team now the interesting thing here is that a lot has changed in Control Tower in the past 12 months and change and if ProductCorp had acquired Fly Money 12 months ago they would have been faced with a very different proposition in terms of solving this problem for a few different reasons the first one is that 12 months ago Control Tower had only just made it to sydney and that was actually city was in the first five regions to get access to Control Tower and products core flyer money operates in a bunch of regions which Control Tower wasn't available in 12 months ago so that's actually quite a big change which has enabled this to happen it's now available in 15 of the 21 AWS regions so well over half and another big change that has happened is you can now select which regions you want to be governed with Control Tower before it was effectively all or nothing and every time new regions were released you had to upgrade Control Tower the six regions that Control Towers not available in are cape town so africa south one and bahrain middle east the thing with those two is there's actually no other AWS regions in those areas but for europe asia pacific and america `eu-south-1` `us-west-1` `ap-east-1` and `ap-northeast-3` the vast majority of companies that are using AWS in those regions are probably going to be using regents now that are covered by Control Tower I did mention though that one of Fly Money's markets was africa so when the cape town region was released which was fairly recently actually Fly Money immediately rushed to move all of their workloads into `af-south-1` which is a bit of a problem for them because that's one of the six regions that's not covered by Control Tower at the moment fortunately for Ben and Marie there is actually a work around here because although Control Tower actions don't happen in regions where Control Tower hasn't been deployed yet Control Tower itself as a solution is actually backed by service catalog and that means that you can get life cycle events out of it and AWS has really kindly written up a whole blog post on how you can use those life cycle events and other AWS services basically by subscribing to the life cycle events you can then replicate a lot of Control Towers workflows by triggering off other services and that's a pattern if you're interested in having other things basically automation built on top of Control Tower that's actually a pattern that you can build on as well so I definitely recommend if you're interested in Control Tower check out that blog post it's in the sources and as we sort of covered earlier when you spin up Control Tower it's not an all or nothing thing anymore but you do also have the ability to deselect regions so if Fly Money and Ben and Marie effectively decide that they only want to have Control Tower govern the regions that they're actually operating in they could do that they could just go in and manually remove all of the other regions where they don't operate I'm not necessarily advocating that as a good idea but if you want regions unenrolled from control for particular reasons that's something you can do govrail updates not a lot has changed here but a lot of the changes that have happened are actually quite impactful one of which will sort of cover the implications of later but there have been updates to the IAM guard rails around protecting Control Tower resources which was set up that way to enable enrollment of existing ous there have also been a number of updates to guard rail names and descriptions to clarify what they actually do which is something when I was first testing this out last year I actually got caught out by so that's quite a nice change and another change that's happened is around the log archive account that's provisioned for governance it used to be that anything around S3 buckets and CloudTrail you just couldn't do anything with and that was mandatory that there were locks on there to disable configuration changes but that's been changed now so if you want to do other things in the log archive account where you do want people to be able to go and change them that's now an elective guardrail so you can opt in or opt out of that so that is good in the sense that it enables or it enables you to do a lot more with the log archive account and to decide how you want to actually operate that which is something you couldn't have done before the ou changes are a pretty big one and as we see from the IAM guardrail changes when I looked at this 12 months ago you would have to go in and create your own organisational units to get things to work with Control Tower and then move accounts over that is no longer the case you can now go ahead and enroll ou's that already exist into Control Tower directly you can also when you spin up Control Tower customise the names of the log archiving ou and the security audit oh you that are created at the beginning with the new Control Tower landing zone and even better the Control Tower accounts page used to only show ou's and accounts that were governed by Control Tower it now shows you everything so it gives you a pretty easy way to go in and make sure that everything that should be governed by Control Tower is now last year I had a bit of a bee in my bonnet about lack of CLI support and there is a new feature in Control Tower which while it doesn't fix everything well it doesn't give me everything that I asked for does fix a lot of the main problems with that before if you wanted to update run roll out Control Tower updates to your accounts they either had to be done manually with each account or via scripting but now you can do it by organisational unit so for ever any oh you that has 300 accounts or less in it there is now a one click button in the Control Tower console that allows you to roll out those updates across every account in the ou so that means it ensures that the version of Control Tower is updated and it also ensures that all of the guardrails are properly applied so this is really important for making sure that you don't end up with drift in systems customisations for Control Tower was something that I hadn't looked at too much when I was playing around with last year but as Control Tower has become a more compelling proposition customisations has actually got a lot better too there's been several bug fixes and general usability improvements but the real big deal here is that customisations version 2 actually introduced a simplified schema so it's now much easier to set up resources using customisations if you want to there have been a couple of security changes uh Control Tower now automatically checks for drift against Control Tower service control policies so those are not uh mandatory enforced guard rails but those are detective guard rails effectively rather than preventive that's now checked for you every day and you can get reports of the results you don't have to do that manually another good change security wise is you used to have to use AWS managed keys for encrypting Control Towers CloudTrail logs um apparently that's got me on the wrong slide sorry about that you used to have to use AWS managed keys for encrypting CloudTrail but now you can bring your own so you can use keys that are already existing or you can create your own customer managed keys for that so that's quite nice in terms of you know if you have policies already for managing keys it allows you to manage that yourself and another really good thing is if you absolutely dislike Control Tower and you decide that you want to get rid of it you can now manually decommission Control Tower from within AWS and this again was something that I did and it used to require a support ticket and then a little bit of waiting for AWS to get back to you so that's nice because it gives people the flexibility now to try it out and if they don't like it it's quite easy to roll back there are also a few things that I talked about last year though that haven't changed and the first one of these is the old chestnut of CLI support Control Tower has improved quite a lot since I last looked at it but it is still fundamentally a ClickOps tool it's not something where you can go ahead and roll it out using the CLI and it's not something where you can make changes and roll out updates using the CLI so probably the one use case where I would be advising you to hold off on looking at Control Tower is large organisations that already have a lot of scripting and programmatic management of their account life cycle process because Control Tower introduces ClickOps steps to that however if you're in a smaller org the bulk update feature actually quite effectively balances this out because even though it is ClickOps you're clicking one button pyrou there's no longer a lot of manual work that you have to do to do a lot of those updates so it's still not there but there is some mitigation there the other thing that Control Tower doesn't have that I talked about last year is allowing you to actually create custom config rules and custom service control policies that are then managed by Control Tower this isn't really a problem though because the ecosystem of automation has grown around Control Tower and there are a lot of examples out there already that you can actually use and modify to have Control Tower life cycle events manage custom guardrails if you want them and you can do that with cloud formation it's still something that I hope to see Control Tower do at some point because having everything managed in one place is really nice but there are ways to do it yourself that are fairly trivial it's a little bit of setup and then it's done so one of the big questions here is does this change the use cases because last year Control Tower was bleeding edge software and I would I sort of had a fairly niche list of recommendations and I would really say that Control Tower works pretty well for everything except for you know as I mentioned large organisations but I think there are some very good specific use cases here so if you know that you're never going to need to create new AWS accounts or you're unlikely to need new AWS accounts in the foreseeable future Control Tower is a really compelling proposition because you can set up your landing zone and you can enroll everything in Control Tower and have Control Tower do a lot of the management for you and all you need to worry about then is the Control Tower updates and likewise if you are in an organisation that doesn't really have account creation processes Control Tower is a really good piece of software or really good service to use because it will basically give you an introductory you know it'll give you a lot of those account creation processes out of the box if you need to make major security improvements Control Tower is really good for giving you a baseline around account setup that then allows you to go in and do some of the dirty work so it gives you logs that are set up properly it gives you a security audit account you can then go in and set up other AWS services things like guard duty some of the other security services and another good use case here is if you get audited a lot and if you find audits really annoying you can basically just you know you can use the Control Tower document documentation and basically say yeah this is what we do so it saves you having to prove a lot of the work that you're doing another good scenario is if you have a cloud migration or a security overhaul that's being done by consultants if you don't have a lot of people with specialised AWS knowledge in your organisation the learning curve for Control Tower is not that steep so it's quite easy for consultants to come and set this up and then for staff who maybe have a bit less knowledge of AWS to maintain it so that's a look at Control Tower 12 months on and a look at the continued adventures of ProductCorp as they uh enter the world of mergers and acquisitions I'm assuming that we're going to have question time now so throw them at me and if you want to contact me later on email addresses on the slides thanks dawn that was awesome um as always your presentations are very very in-depth um but they strike a good balance on um telling a story and actually keeping keeping it interesting it's really good we don't have any questions posted yet now is the time to post them anywhere you like we'll see them and we will ask them on your behalf so while we're doing that nope no one yet I don't see anything I was amazed while we're waiting that there is a whole different part of AWS that i've never touched and that's to do with i've never had to go through an audit or any sort of compliance or anything like that and um just watching that makes me realise how little I know is not really surprising I guess but yeah it's it's a whole beast unto itself and the the the Fly Money use case is one that I used here because I actually think it's quite interesting to look at how much I mean a lot of a lot of cloud providers but AWS in particular will do to help you with an audit and how many places don't leverage that yeah I guess the the more auditing and compliance tools you can use to your advantage the easier the the audits become oh absolutely and particularly with pci um you know sometimes you do wonder like there are obviously companies that do this really well and AWS will willingly abstract a lot of it away for you but sometimes you do wonder you know how much of that how much of that do people go in and manually do or how much of it do they not do properly and they don't you know not even that they don't not even that they lie but they don't realise yeah yeah I could you could certainly see how ignorance could be a big a big big part of part of this because you just don't really know what you don't really know like if I had to sit down and do an audit at the moment I would probably roll over and just cry for a while because I wouldn't even know where to start but now I do start with Control Tower yeah it's not about it's actually not a bad starting point it's it's definitely improved a lot since 12 months and change ago yep and as always with AWS if they keep rolling out improvements then it's only going to get better over time okay doesn't look like we've had any questions come in um but dawn is always on slack or usually around somewhere on slack if you do want to ask the questions um and there was the contact details that you posted just a moment ago as well yeah and i'll sit in the I'm sitting in the uh youtube chat as well so I will answer any other questions that are asked by text cool thanks again dawn yeah thank you for having me 
